CREATE SCHEMA IF NOT EXISTS BDEX4_ESTOQUE;
USE BDEX4_ESTOQUE;

CREATE TABLE IF NOT EXISTS PRODUTOS(
ID_PRODUTO INT PRIMARY KEY,
NOME VARCHAR(100) NOT NULL,
DESCRICAO TEXT NOT NULL,
PRECO DECIMAL(10,2) NOT NULL
);

CREATE TABLE IF NOT EXISTS FORNECEDORES(
ID_FORNECEDOR INT PRIMARY KEY,
CNPJ VARCHAR(20) NOT NULL,
NOME VARCHAR(100) NOT NULL,
CIDADE VARCHAR(100) NOT NULL
);

CREATE TABLE IF NOT EXISTS ARMAZENS(
ID_ARMAZEM INT PRIMARY KEY,
NOME_ARMAZEM VARCHAR(100) NOT NULL,
LOG_ARMAZEM VARCHAR(100) NOT NULL,
NUMLOG_ARMAZEM INT,
BAIRRO_ARMAZEM VARCHAR(100) NOT NULL,
CIDADE_ARMAZEM VARCHAR(100) NOT NULL,
UF_ARMAZEM CHAR(2) NOT NULL);

CREATE TABLE IF NOT EXISTS PEDIDOS_COMPRA(
ID_PEDIDO INT PRIMARY KEY,
DATA_PEDIDO DATE NOT NULL,
HORA_PEDIDO TIME NOT NULL,
FORNECEDOR INT NOT NULL,
CONSTRAINT FORNECEDOR_PEDIDO FOREIGN KEY(FORNECEDOR) 
REFERENCES FORNECEDORES(ID_FORNECEDOR));

CREATE TABLE IF NOT EXISTS PRODUTOS_FORNECEDORES(
PRODUTO INT,
FORNECEDOR INT,
PRIMARY KEY(PRODUTO,FORNECEDOR),
CONSTRAINT PROD_FORN FOREIGN KEY(PRODUTO) REFERENCES PRODUTOS(ID_PRODUTO),
CONSTRAINT FORN_PROD FOREIGN KEY(FORNECEDOR) REFERENCES FORNECEDORES(ID_FORNECEDOR)
);

CREATE TABLE IF NOT EXISTS PRODUTOS_ARMAZENS(
PRODUTO INT,
ARMAZEM INT,
PRIMARY KEY(PRODUTO,ARMAZEM),
CONSTRAINT PROD_ARMZ FOREIGN KEY(PRODUTO) REFERENCES PRODUTOS(ID_PRODUTO),
CONSTRAINT ARMZ_PROD FOREIGN KEY(ARMAZEM) REFERENCES ARMAZENS(ID_ARMAZEM));

ALTER TABLE PRODUTOS_ARMAZENS
ADD QUANTIDADE INT NOT NULL;

INSERT INTO PRODUTOS (ID_PRODUTO, NOME, DESCRICAO, PRECO)
VALUES
    (1, 'Camisa Polo', 'Camisa Polo de algodão', 29.99),
    (2, 'Calça Jeans', 'Calça jeans slim fit', 49.90),
    (3, 'Tênis Esportivo', 'Tênis esportivo para corrida', 79.99),
    (4, 'Mochila Escolar', 'Mochila para estudantes', 39.99),
    (5, 'Fone de Ouvido Bluetooth', 'Fone de ouvido sem fio', 59.99);

INSERT INTO FORNECEDORES (ID_FORNECEDOR, CNPJ, NOME, CIDADE)
VALUES
    (1, '11111111111111', 'Distribuidora de Moda LTDA', 'São Paulo'),
    (2, '22222222222222', 'Jeans & Cia Ltda', 'Rio de Janeiro'),
    (3, '33333333333333', 'Esportivos LTDA', 'Belo Horizonte'),
    (4, '44444444444444', 'Mochilas & Cia', 'Curitiba'),
    (5, '55555555555555', 'Tech Sound Ltda', 'Salvador');

INSERT INTO ARMAZENS (ID_ARMAZEM, NOME_ARMAZEM, LOG_ARMAZEM, NUMLOG_ARMAZEM, BAIRRO_ARMAZEM, CIDADE_ARMAZEM, UF_ARMAZEM)
VALUES
    (1, 'Armazém Central', 'Rua das Indústrias', 123, 'Centro', 'São Paulo', 'SP'),
    (2, 'Armazém Rio', 'Avenida das Palmeiras', 456, 'Centro', 'Rio de Janeiro', 'RJ'),
    (3, 'Depósito BH', 'Rua das Flores', 789, 'Barro Preto', 'Belo Horizonte', 'MG'),
    (4, 'Armazém Sul', 'Rua das Árvores', 101, 'Jardim Botânico', 'Curitiba', 'PR'),
    (5, 'Depósito Salvador', 'Avenida da Praia', 112, 'Barra', 'Salvador', 'BA');

INSERT INTO PEDIDOS_COMPRA (ID_PEDIDO, DATA_PEDIDO, HORA_PEDIDO, FORNECEDOR)
VALUES
    (1, '2024-04-29', '10:00:00', 1),
    (2, '2024-04-30', '11:00:00', 2),
    (3, '2024-05-01', '12:00:00', 3),
    (4, '2024-05-02', '13:00:00', 4),
    (5, '2024-05-03', '14:00:00', 5);

INSERT INTO PRODUTOS_FORNECEDORES (PRODUTO, FORNECEDOR)
VALUES
    (1, 1),
    (2, 2),
    (3, 3),
    (4, 4),
    (5, 5);

UPDATE PRODUTOS SET PRECO = 15.00 WHERE ID_PRODUTO = 1;
UPDATE PRODUTOS SET DESCRICAO = 'Nova descrição' WHERE ID_PRODUTO = 2;

UPDATE FORNECEDORES SET NOME = 'Novo Nome' WHERE ID_FORNECEDOR = 1;
UPDATE FORNECEDORES SET CNPJ = '99999999999999' WHERE ID_FORNECEDOR = 2;

UPDATE ARMAZENS SET CIDADE_ARMAZEM = 'Nova Cidade' WHERE ID_ARMAZEM = 1;
UPDATE ARMAZENS SET UF_ARMAZEM = 'ZZ' WHERE ID_ARMAZEM = 2;

UPDATE PEDIDOS_COMPRA SET DATA_PEDIDO = '2024-05-10' WHERE ID_PEDIDO = 1;
UPDATE PEDIDOS_COMPRA SET HORA_PEDIDO = '14:30:00' WHERE ID_PEDIDO = 2;

UPDATE PRODUTOS_FORNECEDORES SET PRODUTO = 3 WHERE FORNECEDOR = 1;
UPDATE PRODUTOS_FORNECEDORES SET FORNECEDOR = 4 WHERE PRODUTO = 2;

SELECT NOME, PRECO FROM PRODUTOS;

select PRODUTO FROM PRODUTOS_FORNECEDORES;

SELECT FORNECEDOR, COUNT(PRODUTO) AS Produtos_Diferentes_Fornecidos FROM PRODUTOS_FORNECEDORES GROUP BY FORNECEDOR;

SELECT SUM(QUANTIDADE) AS Total_Produtos_Estoque FROM PRODUTOS_ARMAZENS;
